action_priority_list_t* precombat = get_action_priority_list( "precombat" );
action_priority_list_t* def = get_action_priority_list( "default" );
action_priority_list_t* aoe = get_action_priority_list( "aoe" );
action_priority_list_t* st = get_action_priority_list( "st" );

precombat->add_action( "moonkin_form","Executed before combat begins. Accepts non-harmful actions only." );
precombat->add_action( "wrath" );
precombat->add_action( "wrath" );
precombat->add_action( "starfire,if=!talent.stellar_flare" );
precombat->add_action( "stellar_flare" );

def->add_action( "variable,name=is_aoe,value=spell_targets.starfall>(1+(!talent.aetherial_kindling&!talent.starweaver))&talent.starfall","Executed every time the actor is available." );
def->add_action( "variable,name=passive_asp,value=6%spell_haste+talent.natures_balance+talent.orbit_breaker*dot.moonfire.ticking*(buff.orbit_breaker.stack>(27-2*buff.solstice.up))*40" );
def->add_action( "run_action_list,name=aoe,if=variable.is_aoe" );
def->add_action( "run_action_list,name=st" );

aoe->add_action( "moonfire,target_if=refreshable&(target.time_to_die-remains)>6&astral_power.deficit>variable.passive_asp+energize_amount,if=fight_style.dungeonroute" );
aoe->add_action( "sunfire,target_if=refreshable&(target.time_to_die-remains)>6-(spell_targets%2)&astral_power.deficit>variable.passive_asp+energize_amount" );
aoe->add_action( "moonfire,target_if=refreshable&(target.time_to_die-remains)>6&astral_power.deficit>variable.passive_asp+energize_amount,if=!fight_style.dungeonroute" );
aoe->add_action( "stellar_flare,target_if=refreshable" );
aoe->add_action( "force_of_nature" );
aoe->add_action( "fury_of_elune" );
aoe->add_action( "incarnation" );
aoe->add_action( "celestial_alignment" );
aoe->add_action( "potion,if=eclipse.in_both" );
aoe->add_action( "use_items,if=eclipse.in_both" );
aoe->add_action( "warrior_of_elune,if=!talent.lunar_calling&buff.eclipse_solar.remains<7|talent.lunar_calling" );
aoe->add_action( "starfire,if=(!talent.lunar_calling&spell_targets.starfire=1)&(buff.eclipse_solar.up&buff.eclipse_solar.remains<action.starfire.cast_time|eclipse.in_none)" );
aoe->add_action( "wrath,if=(talent.lunar_calling|spell_targets.starfire>1)&(buff.eclipse_lunar.up&(buff.eclipse_lunar.remains<action.wrath.cast_time)|eclipse.in_none)" );
aoe->add_action( "starfall,if=buff.starweavers_warp.up" );
aoe->add_action( "starsurge,if=spell_targets.starfall<2" );
aoe->add_action( "starfall,if=spell_targets.starfall>1" );
aoe->add_action( "convoke_the_spirits" );
aoe->add_action( "new_moon" );
aoe->add_action( "half_moon" );
aoe->add_action( "full_moon" );
aoe->add_action( "warrior_of_elune" );
aoe->add_action( "wild_mushroom" );
aoe->add_action( "starfire,if=talent.lunar_calling|buff.eclipse_lunar.up&spell_targets.starfire>1" );
aoe->add_action( "wrath" );

st->add_action( "sunfire,target_if=refreshable&remains<2&(target.time_to_die-remains)>6" );
st->add_action( "moonfire,target_if=refreshable&remains<2&(target.time_to_die-remains)>6" );
st->add_action( "stellar_flare,target_if=refreshable" );
st->add_action( "force_of_nature,if=eclipse.in_solar&buff.eclipse_solar.remains>4&cooldown.celestial_alignment.remains>15|cooldown.celestial_alignment.ready|fight_remains<10" );
st->add_action( "fury_of_elune" );
st->add_action( "incarnation" );
st->add_action( "celestial_alignment" );
st->add_action( "potion,if=eclipse.in_both|fight_remains<30" );
st->add_action( "use_items,if=eclipse.in_both|fight_remains<20" );
st->add_action( "warrior_of_elune,if=!talent.lunar_calling&buff.eclipse_solar.remains<7|talent.lunar_calling" );
st->add_action( "starfire,if=(!talent.lunar_calling&spell_targets.starfire=1)&(buff.eclipse_solar.up&buff.eclipse_solar.remains<action.starfire.cast_time|eclipse.in_none)" );
st->add_action( "wrath,if=(talent.lunar_calling|spell_targets.starfire>1)&(buff.eclipse_lunar.up&(buff.eclipse_lunar.remains<action.wrath.cast_time)|eclipse.in_none)" );
st->add_action( "starfall,if=buff.starweavers_warp.up" );
st->add_action( "starsurge,if=buff.starlord.up&buff.starlord.stack<3|cooldown.convoke_the_spirits.ready" );
st->add_action( "convoke_the_spirits,if=eclipse.in_both|cooldown.celestial_alignment.remains>55" );
st->add_action( "starsurge,if=astral_power.deficit<variable.passive_asp+action.wrath.energize_amount+(action.starfire.energize_amount+variable.passive_asp)*(buff.eclipse_solar.remains<(gcd.max*3))|fight_remains<5" );
st->add_action( "new_moon" );
st->add_action( "half_moon" );
st->add_action( "full_moon" );
st->add_action( "warrior_of_elune" );
st->add_action( "wild_mushroom" );
st->add_action( "starfire,if=talent.lunar_calling|buff.eclipse_lunar.up&spell_targets.starfire>1" );
st->add_action( "wrath" );
